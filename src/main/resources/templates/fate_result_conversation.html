<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>ì‚¬ì£¼ - ë¶€íŠ¸ìŠ¤íŠ¸ë© ìŠ¤íƒ€ì¼</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light">
<div class="container py-4">

  <h2 class="text-center mb-4">ì‚¬ì£¼ ê²°ê³¼</h2>

  <!-- ì‚¬ìš©ìëª…, ì´í‰ -->
  <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
    <div class="h5 mb-0">ğŸ‘¤ <span th:text="${resultVO.userName}">ì´ë¦„</span></div>
    <div>ì´í‰: <strong th:text="${resultVO.total}">0</strong></div>
  </div>

  <!-- ì˜¤í–‰ í”„ë¡œê·¸ë˜ìŠ¤ë°” -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <h5 class="mb-3">ì˜¤í–‰ ë¶„í¬</h5>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>ğŸŒ³ ëª©(æœ¨)</div>
        <div><span id="val-tree" th:text="${resultVO.tree}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-tree" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>ğŸ”¥ í™”(ç«)</div>
        <div><span id="val-fire" th:text="${resultVO.fire}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-fire" class="progress-bar bg-danger" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>â›°ï¸ í† (åœŸ)</div>
        <div><span id="val-soil" th:text="${resultVO.soil}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-soil" class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>âš™ï¸ ê¸ˆ(é‡‘)</div>
        <div><span id="val-steel" th:text="${resultVO.steel}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-steel" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div>
      <div class="d-flex justify-content-between mb-1">
        <div>ğŸ’§ ìˆ˜(æ°´)</div>
        <div><span id="val-water" th:text="${resultVO.water}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-water" class="progress-bar bg-primary" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
  </div>

  <!-- ìš´ì„¸ ì„ íƒ ë° ê²°ê³¼ -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <label for="fateOption" class="form-label fw-bold mb-3">ìš´ì„¸ í•­ëª© ì„ íƒ</label>
    <select id="fateOption" class="form-select mb-3" onchange="handleOnChange(this)">
      <option value="love">ì—°ì• ìš´</option>
      <option value="health">ê±´ê°•ìš´</option>
      <option value="money">ì¬ë¬¼ìš´</option>
      <option value="job">ì§ì—…ìš´</option>
    </select>
    <div class="alert alert-secondary" role="alert" id="detail" th:text="${resultVO.love}">ë‚´ìš©</div>
  </div>

  <!-- ëŒ“ê¸€ ëª©ë¡ -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <h5>ëŒ“ê¸€ ëª©ë¡</h5>
    <div th:each="c : ${result}" class="border-bottom py-2">
      <strong th:text="${c.userNickName}">ì‚¬ìš©ì</strong> : 
      <span th:text="${c.content}">ëŒ“ê¸€ ë‚´ìš©</span>
    </div>
    <div th:if="${#lists.isEmpty(result)}" class="text-muted">ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>

  <!-- ëŒ“ê¸€ ì‘ì„± -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <h5>ëŒ“ê¸€ ì‘ì„±</h5>
    <form id="conversation_form" th:action="@{/insert_fate_conversation.do}" method="post">
      <input type="hidden" name="targetId" th:value="${resultVO.resultFateId}" />
      <input type="hidden" name="userNickName" th:value="${userNickName}" />
      <div class="mb-3">
        <label for="content" class="form-label">ë‚´ìš©</label>
        <textarea name="content" id="content" rows="3" class="form-control" required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">ëŒ“ê¸€ ë“±ë¡</button>
    </form>
  </div>

  <!-- ì´ë™ ë²„íŠ¼ -->
  <div class="d-flex justify-content-between mb-4">
    <a href="/fate_list.do" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ ê°€ê¸°</a>
  </div>

</div>

<script th:inline="javascript">
  function handleOnChange(e) {
    const value = e.value;
    let text = "";
    if (value === "love") {
      text = /*[[${resultVO.love}]]*/"";
    } else if (value === "health") {
      text = /*[[${resultVO.health}]]*/"";
    } else if (value === "money") {
      text = /*[[${resultVO.money}]]*/"";
    } else if (value === "job") {
      text = /*[[${resultVO.job}]]*/"";
    }
    document.getElementById('detail').innerText = text;
  }

  window.onload = function() {
    // ì˜¤í–‰ ê°’ë“¤
    const tree = /*[[${resultVO.tree}]]*/0;
    const fire = /*[[${resultVO.fire}]]*/0;
    const soil = /*[[${resultVO.soil}]]*/0;
    const steel = /*[[${resultVO.steel}]]*/0;
    const water = /*[[${resultVO.water}]]*/0;

    const max = Math.max(tree, fire, soil, steel, water, 1);

    // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ë„ˆë¹„ ì„¤ì •
    document.getElementById('progress-tree').style.width = (tree / max * 100) + '%';
    document.getElementById('progress-fire').style.width = (fire / max * 100) + '%';
    document.getElementById('progress-soil').style.width = (soil / max * 100) + '%';
    document.getElementById('progress-steel').style.width = (steel / max * 100) + '%';
    document.getElementById('progress-water').style.width = (water / max * 100) + '%';

    // ìš´ì„¸ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
    const select = document.getElementById('fateOption');
    handleOnChange(select);
  };
</script>
</body>
</html>
