<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>사주 - 부트스트랩 스타일</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="bg-light">
<div class="container py-4">

  <h2 class="text-center mb-4">사주 결과</h2>

  <!-- 사용자명, 총평 -->
  <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-white rounded shadow-sm">
    <div class="h5 mb-0">👤 <span th:text="${resultVO.userName}">이름</span></div>
    <div>총평: <strong th:text="${resultVO.total}">0</strong></div>
  </div>

  <!-- 오행 프로그래스바 -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <h5 class="mb-3">오행 분포</h5>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>🌳 목(木)</div>
        <div><span id="val-tree" th:text="${resultVO.tree}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-tree" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>🔥 화(火)</div>
        <div><span id="val-fire" th:text="${resultVO.fire}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-fire" class="progress-bar bg-danger" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>⛰️ 토(土)</div>
        <div><span id="val-soil" th:text="${resultVO.soil}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-soil" class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div class="mb-3">
      <div class="d-flex justify-content-between mb-1">
        <div>⚙️ 금(金)</div>
        <div><span id="val-steel" th:text="${resultVO.steel}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-steel" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
    <div>
      <div class="d-flex justify-content-between mb-1">
        <div>💧 수(水)</div>
        <div><span id="val-water" th:text="${resultVO.water}">0</span></div>
      </div>
      <div class="progress" style="height: 20px;">
        <div id="progress-water" class="progress-bar bg-primary" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
      </div>
    </div>
  </div>

  <!-- 운세 선택 및 결과 -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <label for="fateOption" class="form-label fw-bold mb-3">운세 항목 선택</label>
    <select id="fateOption" class="form-select mb-3" onchange="handleOnChange(this)">
      <option value="love">연애운</option>
      <option value="health">건강운</option>
      <option value="money">재물운</option>
      <option value="job">직업운</option>
    </select>
    <div class="alert alert-secondary" role="alert" id="detail" th:text="${resultVO.love}">내용</div>
  </div>

  <!-- 댓글 목록 -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <h5>댓글 목록</h5>
    <div th:each="c : ${result}" class="border-bottom py-2">
      <strong th:text="${c.userNickName}">사용자</strong> : 
      <span th:text="${c.content}">댓글 내용</span>
    </div>
    <div th:if="${#lists.isEmpty(result)}" class="text-muted">등록된 댓글이 없습니다.</div>
  </div>

  <!-- 댓글 작성 -->
  <div class="bg-white rounded shadow-sm p-3 mb-4">
    <h5>댓글 작성</h5>
    <form id="conversation_form" th:action="@{/insert_fate_conversation.do}" method="post">
      <input type="hidden" name="targetId" th:value="${resultVO.resultFateId}" />
      <input type="hidden" name="userNickName" th:value="${userNickName}" />
      <div class="mb-3">
        <label for="content" class="form-label">내용</label>
        <textarea name="content" id="content" rows="3" class="form-control" required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">댓글 등록</button>
    </form>
  </div>

  <!-- 이동 버튼 -->
  <div class="d-flex justify-content-between mb-4">
    <a href="/fate_list.do" class="btn btn-secondary">목록으로 가기</a>
  </div>

</div>

<script th:inline="javascript">
  function handleOnChange(e) {
    const value = e.value;
    let text = "";
    if (value === "love") {
      text = /*[[${resultVO.love}]]*/"";
    } else if (value === "health") {
      text = /*[[${resultVO.health}]]*/"";
    } else if (value === "money") {
      text = /*[[${resultVO.money}]]*/"";
    } else if (value === "job") {
      text = /*[[${resultVO.job}]]*/"";
    }
    document.getElementById('detail').innerText = text;
  }

  window.onload = function() {
    // 오행 값들
    const tree = /*[[${resultVO.tree}]]*/0;
    const fire = /*[[${resultVO.fire}]]*/0;
    const soil = /*[[${resultVO.soil}]]*/0;
    const steel = /*[[${resultVO.steel}]]*/0;
    const water = /*[[${resultVO.water}]]*/0;

    const max = Math.max(tree, fire, soil, steel, water, 1);

    // 프로그레스 바 너비 설정
    document.getElementById('progress-tree').style.width = (tree / max * 100) + '%';
    document.getElementById('progress-fire').style.width = (fire / max * 100) + '%';
    document.getElementById('progress-soil').style.width = (soil / max * 100) + '%';
    document.getElementById('progress-steel').style.width = (steel / max * 100) + '%';
    document.getElementById('progress-water').style.width = (water / max * 100) + '%';

    // 운세 텍스트 초기화
    const select = document.getElementById('fateOption');
    handleOnChange(select);
  };
</script>
</body>
</html>
