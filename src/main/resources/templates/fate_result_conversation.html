<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
	<th:block th:replace="~{fragments/styles :: commonStyles}"></th:block>
  <title>ì‚¬ì£¼ ê²°ê³¼</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <style>
    :root {
      --accent: #c92a2a;
      --bg: #f8f9fa;
      --radius: 12px;
    }

    body {
      background-color: var(--bg);
    }

    .page-container {
      max-width: 800px;
      margin: 40px auto;
      padding: 0 16px;
    }

    .card-custom {
      background-color: #ffffff;
      border-radius: var(--radius);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.05);
      padding: 24px;
      margin-bottom: 24px;
      width: 100%;
    }

    .progress {
      height: 20px;
    }

    .btn-custom {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: var(--radius);
      font-weight: bold;
      transition: background 0.2s ease;
    }

    .btn-custom:hover {
      background: #a61e4d;
    }

    .comment-item {
      background: #ffffff;
      border: 1px solid #dee2e6;
      border-radius: var(--radius);
      padding: 12px 16px;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>

<div class="page-container">

  <div class="d-flex flex-column align-items-center">    
    <!-- ì œëª©--> 
    <div class="title-box">ì‚¬ì£¼ ëª©ë¡ ìƒì„¸</div>

    <!-- ì‚¬ìš©ì ì •ë³´ ë° ì´í‰ -->
    <div class="card-custom d-flex justify-content-between align-items-center">
      <div class="h5 mb-0">ğŸ‘¤ <span th:text="${resultVO.userName}">ì´ë¦„</span></div>
      <div>ì´í‰: <strong th:text="${resultVO.total}">0</strong></div>
    </div>

    <!-- ì˜¤í–‰ ë¶„í¬ -->
    <div class="card-custom">
      <h5 class="mb-3 fw-bold">ğŸŒ± ì˜¤í–‰ ë¶„í¬</h5>

      <div class="mb-3">
        <div class="d-flex justify-content-between mb-1"><div>ğŸŒ³ ëª©(æœ¨)</div><div><span id="val-tree" th:text="${resultVO.tree}">0</span></div></div>
        <div class="progress"><div id="progress-tree" class="progress-bar bg-success" style="width: 0%"></div></div>
      </div>

      <div class="mb-3">
        <div class="d-flex justify-content-between mb-1"><div>ğŸ”¥ í™”(ç«)</div><div><span id="val-fire" th:text="${resultVO.fire}">0</span></div></div>
        <div class="progress"><div id="progress-fire" class="progress-bar bg-danger" style="width: 0%"></div></div>
      </div>

      <div class="mb-3">
        <div class="d-flex justify-content-between mb-1"><div>â›°ï¸ í† (åœŸ)</div><div><span id="val-soil" th:text="${resultVO.soil}">0</span></div></div>
        <div class="progress"><div id="progress-soil" class="progress-bar bg-warning" style="width: 0%"></div></div>
      </div>

      <div class="mb-3">
        <div class="d-flex justify-content-between mb-1"><div>âš™ï¸ ê¸ˆ(é‡‘)</div><div><span id="val-steel" th:text="${resultVO.steel}">0</span></div></div>
        <div class="progress"><div id="progress-steel" class="progress-bar bg-info" style="width: 0%"></div></div>
      </div>

      <div>
        <div class="d-flex justify-content-between mb-1"><div>ğŸ’§ ìˆ˜(æ°´)</div><div><span id="val-water" th:text="${resultVO.water}">0</span></div></div>
        <div class="progress"><div id="progress-water" class="progress-bar bg-primary" style="width: 0%"></div></div>
      </div>
    </div>

    <!-- ìš´ì„¸ ì„ íƒ -->
    <div class="card-custom">
      <label for="fateOption" class="form-label fw-bold">ğŸ” ìš´ì„¸ í•­ëª© ì„ íƒ</label>
      <select id="fateOption" class="form-select mb-3" onchange="handleOnChange(this)">
        <option value="love">ì—°ì• ìš´</option>
        <option value="health">ê±´ê°•ìš´</option>
        <option value="money">ì¬ë¬¼ìš´</option>
        <option value="job">ì§ì—…ìš´</option>
      </select>
      <div class="border rounded p-3 bg-light" id="detail" th:text="${resultVO.love}">ë‚´ìš©</div>
    </div>

    <!-- ëŒ“ê¸€ ëª©ë¡ -->
    <div class="card-custom">
      <h5 class="mb-3">ğŸ’¬ ëŒ“ê¸€ ëª©ë¡</h5>
      <div th:each="c : ${result}" class="comment-item">
        <strong th:text="${c.userNickName}">ì‚¬ìš©ì</strong> :
        <span th:text="${c.content}">ëŒ“ê¸€ ë‚´ìš©</span>
      </div>
      <div th:if="${#lists.isEmpty(result)}" class="text-muted">ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>

    <!-- ëŒ“ê¸€ ì‘ì„± -->
    <div class="card-custom">
      <h5 class="mb-3">âœï¸ ëŒ“ê¸€ ì‘ì„±</h5>
      <form id="conversation_form" th:action="@{/insert_fate_conversation.do}" method="post">
        <input type="hidden" name="targetId" th:value="${resultVO.resultFateId}" />
        <input type="hidden" name="userNickName" th:value="${userNickName}" />
        <div class="mb-3">
          <label for="content" class="form-label">ë‚´ìš©</label>
          <textarea name="content" id="content" rows="3" class="form-control" required></textarea>
        </div>
        <button type="submit" class="btn btn-custom">ëŒ“ê¸€ ë“±ë¡</button>
      </form>
    </div>

    <!-- ì´ë™ ë²„íŠ¼ -->
    <div class="d-flex justify-content-between mt-4">
      <a href="/fate_list.do" class="btn btn-outline-secondary">ëª©ë¡ìœ¼ë¡œ ê°€ê¸°</a>
    </div>
  </div>
</div>

<script th:inline="javascript">
  function handleOnChange(e) {
    const value = e.value;
    let text = "";
    if (value === "love") {
      text = /*[[${resultVO.love}]]*/"";
    } else if (value === "health") {
      text = /*[[${resultVO.health}]]*/"";
    } else if (value === "money") {
      text = /*[[${resultVO.money}]]*/"";
    } else if (value === "job") {
      text = /*[[${resultVO.job}]]*/"";
    }
    document.getElementById('detail').innerText = text;
  }

  window.onload = function () {
    const tree = /*[[${resultVO.tree}]]*/0;
    const fire = /*[[${resultVO.fire}]]*/0;
    const soil = /*[[${resultVO.soil}]]*/0;
    const steel = /*[[${resultVO.steel}]]*/0;
    const water = /*[[${resultVO.water}]]*/0;

    const max = Math.max(tree, fire, soil, steel, water, 1);

    document.getElementById('progress-tree').style.width = (tree / max * 100) + '%';
    document.getElementById('progress-fire').style.width = (fire / max * 100) + '%';
    document.getElementById('progress-soil').style.width = (soil / max * 100) + '%';
    document.getElementById('progress-steel').style.width = (steel / max * 100) + '%';
    document.getElementById('progress-water').style.width = (water / max * 100) + '%';

    handleOnChange(document.getElementById('fateOption'));
  };
</script>

</body>
</html>