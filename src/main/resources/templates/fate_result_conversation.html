<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>사주 상세 및 대화</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
	<div class="container py-5">
		
		<!-- 사주 상세 정보 -->
		<div class="card shadow-sm mb-4">
			<div class="card-body">
				<h2 class="card-title mb-4 text-center">사주 상세 결과</h2>
				<ul class="list-group list-group-flush mb-4">
					<li class="list-group-item">username: <span th:text="${resultVO.userName}"></span></li>
					<li class="list-group-item">tree: <span th:text="${resultVO.tree}"></span></li>
					<li class="list-group-item">fire: <span th:text="${resultVO.fire}"></span></li>
					<li class="list-group-item">soil: <span th:text="${resultVO.soil}"></span></li>
					<li class="list-group-item">steel: <span th:text="${resultVO.steel}"></span></li>
					<li class="list-group-item">water: <span th:text="${resultVO.water}"></span></li>
					<li class="list-group-item">total: <span th:text="${resultVO.total}"></span></li>
				</ul>

				<div class="mb-3">
					<label for="fateOption" class="form-label">운세 선택</label>
					<select class="form-select" id="fateOption" onchange="handleOnChange(this)">
						<option value="love">연애운</option>
						<option value="health">건강운</option>
						<option value="money">재물운</option>
						<option value="job">직업운</option>
					</select>
				</div>

				<div class="alert alert-info">
					<strong>운세 결과:</strong>
					<span id="detail" th:text="${resultVO.love}"></span>
				</div>
			</div>
		</div>

		<!-- 댓글 목록 -->
		<div class="card shadow-sm mb-4">
			<div class="card-body">
				<h3 class="card-title mb-3">댓글 목록</h3>
				<div th:each="c : ${result}" class="border-bottom py-2">
					<b th:text="${c.userNickName}">사용자</b> : 
					<span th:text="${c.content}"></span>
				</div>
			</div>
		</div>

		<!-- 댓글 작성 -->
		<div class="card shadow-sm mb-4">
			<div class="card-body">
				<h4 class="mb-3">댓글 작성</h4>
				<form id="conversation_form" th:action="@{/insert_fate_conversation.do}" method="post">
					<input type="hidden" name="targetId" th:value="${resultVO.resultFateId}" />
					<input type="hidden" name="userNickName" th:value="${userNickName}" />

					<div class="mb-3">
						<label for="content" class="form-label">내용</label>
						<textarea name="content" id="content" rows="3" class="form-control" required></textarea>
					</div>
					<button type="submit" class="btn btn-primary">댓글 등록</button>
				</form>
			</div>
		</div>

		<!-- 이동 버튼 -->
		<div class="d-flex justify-content-between">
			<a href="/fate_input_form.do" class="btn btn-secondary">다시 입력하기</a>
			<a href="/conversation_list_fate.do" class="btn btn-secondary">목록으로 가기</a>
		</div>
	</div>

	<script th:inline="javascript">
		function handleOnChange(e) {
			const value = e.value;
			let text = "";
			if (value === "love") {
				text = /*[[${resultVO.love}]]*/"";
			} else if (value === "health") {
				text = /*[[${resultVO.health}]]*/"";
			} else if (value === "money") {
				text = /*[[${resultVO.money}]]*/"";
			} else if (value === "job") {
				text = /*[[${resultVO.job}]]*/"";
			}
			document.getElementById('detail').innerText = text;
		}
		window.onload = function() {
			const select = document.querySelector("#fateOption");
			handleOnChange(select);
		}
	</script>
</body>
</html>
