<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>사주 상세 및 대화</title>
</head>
<body>
<div align="center">
    <!-- 사주 상세 정보 -->
    <h2>사주 상세 결과</h2>
    <p>username: <span th:text="${resultVO.userName}"></span></p>
    <p>tree: <span th:text="${resultVO.tree}"></span></p>
    <p>fire: <span th:text="${resultVO.fire}"></span></p>
    <p>soil: <span th:text="${resultVO.soil}"></span></p>
    <p>steel: <span th:text="${resultVO.steel}"></span></p>
    <p>water: <span th:text="${resultVO.water}"></span></p>
    <p>total: <span th:text="${resultVO.total}"></span></p>

    <select name="fateOption" id="fateOption" onchange="handleOnChange(this)">
        <option value="love">연애운</option>
        <option value="health">건강운</option>
        <option value="money">재물운</option>
        <option value="job">직업운</option>
    </select>

    <p>운세 결과:</p>
    <span id="detail" th:text="${resultVO.love}"></span>

    <hr>
    
    <h3>댓글 목록</h3>
    <div th:each="c : ${result}">
        <b th:text="${c.userId}">사용자</b> : <span th:text="${c.content}"></span><hr>
    </div>

    <form id="conversation_form" th:action="@{/insert_fate_conversation.do}" method="post" class="mt-4">
        <input type="hidden" name="targetId" th:value="${resultVO.resultFateId}" />
        <div class="mb-3">
            <label for="userId" class="form-label">이름</label>
            <input type="text" name="userId" id="userId" class="form-control" required />
        </div>
        <div class="mb-3">
            <label for="content" class="form-label">내용</label>
            <textarea name="content" id="content" rows="3" class="form-control" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">댓글 등록</button>
    </form>

    <div class="mt-4 d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" onclick="location.href='/fate_input_form.do'">다시 입력하기</button>
        <button type="button" class="btn btn-secondary" onclick="location.href='/conversation_list_fate.do'">목록으로 가기</button>
    </div>
</div>

    <a href="/conversation_list_fate.do">리스트로</a>
</div>

<script th:inline="javascript">
function handleOnChange(e) {
    const value = e.value;
    let text = "";
    if (value === "love") {
        text = /*[[${resultVO.love}]]*/"";
    } else if (value === "health") {
        text = /*[[${resultVO.health}]]*/"";
    } else if (value === "money") {
        text = /*[[${resultVO.money}]]*/"";
    } else if (value === "job") {
        text = /*[[${resultVO.job}]]*/"";
    }
    document.getElementById('detail').innerText = text;
}
window.onload = function() {
    const select = document.querySelector("#fateOption");
    handleOnChange(select);
}
</script>
</body>
</html>
