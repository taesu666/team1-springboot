
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />

<title th:text="${travel.travelName} + ' - 지도'">여행지 지도</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<style>
body {
	background: #f7f8fa;
}

.map-wrap {
	width: 1080px;
	margin: 24px auto;
}

.card {
	border-radius: 1rem;
	overflow: hidden;
}

#map {
	width: 100%;
	height: 420px;
}

.row {
	display: flex;
	flex-direction: row;
}

.col {
	width: 50%;
}
</style>
</head>
<body>
	
	<div class="map-wrap">
		<div class="mb-3">
			<a href="javascript:history.back()"
				class="btn btn-outline-secondary btn-sm">&larr; 뒤로</a> <!-- &larr = 뒤로가기 왼쪽 화살표 -->
		</div>

		<div class="card shadow-sm mb-3">
			<div class="row">
				<div class="col">
					<img th:src="${travel.travelImage}" alt="여행 이미지"
						style="width: 100%; height: 100%; object-fit: cover; min-height: 240px;">
				</div>
				<div class="col p-4">
					<h4 class="fw-bold mb-2" th:text="${travel.travelName}">여행지 이름</h4>
					<div class="text-secondary mb-2">
						<span class="badge bg-secondary-subtle text-secondary fw-bold"
							th:text="${travel.maxFive}">오행</span>
					</div>
					<div class="mb-2">
						<span class="fw-semibold">위치: </span> <span
							th:text="${travel.travelLocation}">서울 종로구 경복궁</span>
					</div>
					<p class="mb-0" th:text="${travel.travelDescription}">여행지 설명</p>
				</div>
			</div>
		</div>

		<div class="card shadow-sm">
			<div class="card-body">
				<h5 class="fw-bold mb-3">지도</h5>
				<div id="map"
					th:attr="data-address=${travel.travelLocation},
                    data-title=${travel.travelName},
                    data-desc=${travel.travelDescription}">
				</div>
			</div>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script
		th:src="@{'https://maps.googleapis.com/maps/api/js?key=' + ${mapsApiKey} + '&callback=initMap'}"
		async defer></script>

	<script>
  // 지도 초기화
  function initMap() {
    const el = document.getElementById('map');
    const address = el.getAttribute('data-address');
    const title = el.getAttribute('data-title');
    const desc = el.getAttribute('data-desc');

    const map = new google.maps.Map(el, { center: { lat: 36.5, lng: 127.8 }, zoom: 6 });

    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ address }, (results, status) => {
      if (status === "OK" && results && results[0]) {
        const loc = results[0].geometry.location;
        map.setCenter(loc);
        map.setZoom(14);

        const marker = new google.maps.Marker({ map, position: loc, title });
        const infowindow = new google.maps.InfoWindow({
          content: `
            <div style="max-width:220px">
              <div style="font-weight:700;margin-bottom:4px;">${title}</div>
              <div style="font-size:12px;color:#555;margin-bottom:4px;">${address}</div>
              <div style="font-size:12px;color:#666;">${desc ?? ''}</div>
            </div>`
        });
        marker.addListener('click', () => infowindow.open({ anchor: marker, map }));
      } else {
        console.warn("Geocode 실패:", status);
      }
    });
  }
</script>
</body>
</html>

